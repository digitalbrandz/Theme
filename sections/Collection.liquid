{% style %}
.collection-page li.product .buynow {
background:{{ section.settings.buynowbackground }};
color:{{ section.settings.buynowcolor }};
}
{% endstyle %}

{% paginate collection.products by 12 %}


{% assign min = 0 %}
{% assign max = 100000 %}
{% assign diff = max | minus: min %}
{% assign randomNumber = "now" | date: "%N" | modulo: diff | plus: min %}

<div class="collection-{{ randomNumber }}">
<div class="row align-justify align-middle collection-title">
  <div class="columns large-12 text-center">
  <h1>{{ collection.title }}</h1>
  </div>
  


</div>

  {% comment %}
    Listing all tags within the current collection.
    Shopify uses product tags to manage subcategories inside collections.
    See 'How do I create subcategories of products?' at 
    http://bit.ly/1j1Dti4 for details.
  {% endcomment %}



  {% if collection.description.size > 0 %}
  <div class="row">
    <div class="column">
    {{ collection.description }}
    </div>
   </div>
  {% endif %}
  
  
<ul class="row align-center align-bottom collection-container">
{% assign products_per = section.settings.products_per | plus: 0 %}  
{% if products_per == 2 %}
  {% assign sizes = 'large-6 medium-6' %}
  {% elsif products_per == 3 %}
  {% assign sizes = 'large-4 medium-4' %}
  {% elsif products_per == 4 %}
  {% assign sizes = 'large-3 medium-6' %}
{% endif %}  
  {% for product in collection.products %}
  
  
  
  
{% if product.type == "OPTIONS_HIDDEN_PRODUCT" %}{% continue %}{% endif %}
{% comment %}Is this product on sale?{% endcomment %}
{% assign on_sale = false %}
{% if product.compare_at_price > product.price %}
{% assign on_sale = true %}
{% endif %}
<li itemscope itemtype="http://schema.org/Product" data-id="{{ product.id }}" class="text-center columns {{ sizes }} small-6 product {% if product.type contains 'book' %}book{% endif %} {% unless product.available %} sold-out{% endunless %}{% if on_sale %} on-sale{% endif %}">
   <a href="{{ product.url | within: collection }}">
      <div class="image">
         {% if product.featured_image %}<img src="{{ product.featured_image | img_url: '1024x1024' }}" />{% endif %}
      </div>
      <h3>{{ product.title }}</h3>
      <p class="h1 medium-down--left">
         {% if product.price_max > product.price %}
         {% include 'price' with product.price_min %} 
         {% else %}
         {% include 'price' with product.price %}
         {% endif %}
      </p>
      {% if on_sale %}
      <div class="salew">
         <span class="sale-tag medium-down--right{% if settings.product_reviews_enable %} has-reviews{% endif %}">
         {% assign compare_price = product.compare_at_price %}
         {% assign product_price = product.price %}
         {% include 'price-sale' %}
         </span>
      </div>
      {% endif %}
   </a>
  {% if section.settings.sezzle %}
   {% if product.price_max > product.price %}
   {% assign totalprice = product.price_min %}   
   {% else %}
   {% assign totalprice = product.price %}      
   {% endif %}
  
   <div class="sezzle-wrap">
      or 4 interest-free payments of
      <span>
         {% assign sezzleprice = totalprice | divided_by: 4 %}
         <span>{% include 'price' with sezzleprice %}</span> 
         <w>with</w>
         <svg width="797pt" height="263pt" viewBox="0 0 797 263" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <g id="#93d063ff">
               <path fill="#93d063" opacity="1.00" d=" M 72.83 40.94 C 72.48 25.43 81.15 11.78 90.46 0.12 C 93.52 11.83 96.08 24.02 102.70 34.36 C 118.47 58.39 140.29 77.47 158.49 99.54 C 166.96 110.05 175.16 121.04 180.45 133.55 C 184.37 143.05 186.12 154.17 182.02 163.91 C 178.77 172.18 172.84 178.90 167.50 185.86 C 164.34 173.42 159.75 161.20 152.42 150.59 C 134.20 123.94 109.40 102.90 87.87 79.10 C 78.58 68.70 72.14 55.12 72.83 40.94 Z" />
               <path fill="#93d063" opacity="1.00" d=" M 42.70 55.69 C 45.76 49.28 50.33 43.80 54.72 38.27 C 56.83 51.70 60.86 65.09 68.68 76.36 C 86.47 101.53 110.35 121.58 128.72 146.28 C 135.36 155.03 141.36 164.40 145.24 174.73 C 147.91 182.16 149.48 190.44 147.16 198.18 C 144.24 208.05 137.53 216.07 131.46 224.15 C 127.86 211.06 123.14 198.00 114.96 187.02 C 96.69 161.34 72.64 140.67 51.66 117.35 C 44.86 109.74 39.54 100.56 37.55 90.48 C 35.39 78.74 37.02 66.24 42.70 55.69 Z" />
            </g>
            <g id="#000000ff">
               <path fill="#000000" opacity="1.00" d=" M 667.03 67.75 C 673.75 67.79 680.48 67.78 687.21 67.76 C 687.21 111.90 687.31 156.03 687.25 200.17 C 680.51 200.15 673.77 200.13 667.03 200.18 C 667.05 156.04 667.05 111.89 667.03 67.75 Z" />
               <path fill="#000000" opacity="1.00" d=" M 250.98 101.99 C 255.74 97.36 262.79 97.38 268.98 97.16 C 289.20 96.79 309.42 97.09 329.64 97.01 C 329.52 104.28 329.50 111.56 329.62 118.83 C 307.73 118.81 285.84 118.83 263.95 118.81 C 264.00 125.53 264.00 132.24 264.01 138.96 C 281.04 139.02 298.06 138.68 315.08 138.92 C 318.70 139.03 322.50 139.36 325.66 141.30 C 330.72 144.36 333.82 150.10 334.05 155.96 C 334.46 165.31 334.61 174.71 334.01 184.06 C 333.80 188.92 331.52 193.68 327.54 196.56 C 323.18 200.07 317.32 200.22 311.98 200.23 C 290.00 200.07 268.01 200.22 246.03 200.11 C 246.18 193.08 246.26 186.06 246.31 179.03 C 268.92 178.98 291.53 179.09 314.14 179.21 C 314.11 172.64 314.11 166.08 314.13 159.52 C 297.75 159.48 281.37 159.82 265.00 159.46 C 260.27 159.39 255.19 158.74 251.47 155.52 C 247.54 152.56 245.72 147.66 245.40 142.88 C 244.74 134.26 244.87 125.59 245.19 116.95 C 245.37 111.53 246.68 105.67 250.98 101.99 Z" />
               <path fill="#000000" opacity="1.00" d=" M 347.84 114.93 C 347.81 106.08 355.20 97.95 364.13 97.59 C 381.05 96.43 398.04 97.22 415.00 96.98 C 422.21 96.91 430.26 96.96 436.05 101.95 C 439.94 104.99 441.82 109.84 442.22 114.65 C 443.16 124.51 443.25 134.51 442.03 144.36 C 441.23 151.60 435.15 157.72 428.02 158.90 C 424.73 159.46 421.38 159.44 418.06 159.52 C 401.05 159.75 384.04 159.41 367.03 159.63 C 367.07 166.12 367.06 172.61 367.04 179.10 C 390.78 179.66 414.61 177.77 438.28 180.33 C 438.04 186.89 438.09 193.46 437.99 200.02 C 413.64 200.04 389.28 200.40 364.94 199.95 C 356.64 199.83 349.40 192.92 348.09 184.88 C 347.43 180.96 347.57 176.96 347.57 173.00 C 347.77 153.64 347.44 134.28 347.84 114.93 M 367.01 118.84 C 367.06 125.55 367.10 132.25 367.16 138.96 C 385.68 138.94 404.19 138.96 422.71 138.96 C 422.66 132.20 422.68 125.44 422.76 118.68 C 404.18 118.75 385.59 118.83 367.01 118.84 Z" />
               <path fill="#000000" opacity="1.00" d=" M 453.00 96.99 C 485.03 97.02 517.06 97.00 549.09 97.00 C 548.88 102.04 549.71 107.87 545.87 111.83 C 526.38 134.07 507.20 156.57 487.90 178.98 C 508.00 179.05 528.11 179.07 548.21 178.99 C 548.24 186.01 548.92 193.01 549.04 200.03 C 517.00 200.09 484.95 200.22 452.90 200.19 C 453.12 195.28 451.89 189.52 455.59 185.57 C 475.08 163.40 494.43 141.11 514.00 119.01 C 493.67 118.70 473.34 118.78 453.01 118.82 C 453.04 111.54 452.98 104.27 453.00 96.99 Z" />
               <path fill="#000000" opacity="1.00" d=" M 558.37 97.02 C 590.51 96.98 622.66 96.99 654.81 97.02 C 654.66 101.49 655.57 106.65 652.30 110.29 C 632.95 133.36 612.88 155.83 593.70 179.05 C 613.77 179.05 633.83 179.04 653.90 179.00 C 654.23 186.04 654.62 193.07 654.85 200.12 C 622.67 200.15 590.49 200.21 558.31 200.11 C 558.48 194.86 557.28 188.60 561.56 184.58 C 574.25 170.88 586.30 156.61 598.65 142.60 C 605.51 134.63 612.75 127.00 619.56 118.97 C 599.17 118.61 578.78 118.85 558.39 118.80 C 558.52 111.54 558.49 104.28 558.37 97.02 Z" />
               <path fill="#000000" opacity="1.00" d=" M 715.08 98.11 C 718.96 97.15 722.99 97.17 726.97 97.06 C 742.33 96.90 757.69 97.00 773.05 97.02 C 779.45 96.94 786.47 98.03 791.06 102.94 C 797.71 109.41 796.50 119.54 796.84 128.00 C 796.47 137.00 798.06 147.93 790.63 154.65 C 785.80 159.61 778.46 159.41 772.06 159.50 C 755.10 159.82 738.13 159.40 721.17 159.55 C 721.22 166.09 721.21 172.63 721.19 179.17 C 744.73 179.03 768.28 179.04 791.83 179.00 C 791.89 186.05 791.94 193.10 792.01 200.16 C 768.31 200.12 744.61 200.26 720.92 200.06 C 715.17 200.18 709.41 197.73 705.89 193.12 C 702.62 189.23 702.13 183.94 702.10 179.07 C 702.01 162.04 701.97 145.02 702.04 127.99 C 702.10 122.74 701.79 117.45 702.42 112.22 C 703.16 105.48 708.57 99.74 715.08 98.11 M 721.15 118.78 C 721.22 125.51 721.30 132.23 721.31 138.96 C 740.11 138.96 758.92 138.94 777.73 138.95 C 777.74 132.24 777.79 125.52 777.85 118.81 C 758.95 118.83 740.05 118.83 721.15 118.78 Z" />
            </g>
            <g id="#4bb63fff">
               <path fill="#4bb63f" opacity="1.00" d=" M 1.47 107.64 C 3.83 96.04 10.60 85.99 18.08 77.06 C 21.09 88.89 23.70 101.18 30.49 111.55 C 46.23 135.30 67.82 154.25 85.86 176.14 C 94.35 186.64 102.55 197.62 107.91 210.11 C 111.59 218.94 113.49 229.09 110.36 238.37 C 107.20 247.41 101.15 255.01 95.13 262.31 C 91.77 250.17 87.51 238.08 80.33 227.63 C 65.18 205.84 45.67 187.66 27.43 168.55 C 19.62 160.30 10.99 152.43 5.92 142.07 C 0.36 131.58 -0.55 119.18 1.47 107.64 Z" />
            </g>
         </svg>
         <span class="sezzle-info-icon">â“˜</span>            
      </span>
   </div>
  {% endif %}
   <a href="{{ product.url }}" class="buynow add-product">{{ section.settings.buynowtext }}</a>
</li>
   
  
  
  
  {% else %}
    <p>There are no products in this view.</p>
  {% endfor %}
 </ul>
  {% if paginate.pages > 1 %}
<div class="pagination">
    {{ paginate | default_pagination }}
</div>
  {% endif %}
</div>  
  
<script> 
var callbackCollection = function(){
  // Handler when the DOM is fully loaded
  if(!window.InfiniteScroll) {
   // add script
    var script = document.createElement("script");
    script.type = "text/javascript";   
    script.src = 'https://unpkg.com/infinite-scroll@3/dist/infinite-scroll.pkgd.min.js';
    document.getElementsByTagName("head")[0].appendChild(script);   
  }
};

if (
    document.readyState === "complete" ||
    (document.readyState !== "loading" && !document.documentElement.doScroll)
) {
  callbackCollection();
} else {
  document.addEventListener("DOMContentLoaded", callbackCollection);
}
  
function deferCollection(methodCollection) {
    if (window.InfiniteScroll) {
        methodCollection();
    } else {
        setTimeout(function() { deferCollection(methodCollection) }, 50);
    }
}
deferCollection(function() {  

    
loadCollection();
  
   var currentPage = document.querySelector('.collection-{{ randomNumber }}').closest('[data-role="page"]');


 // if jquery mobile
  if(window.$.mobile) {
   setTimeout(function() { 
   jQuery(document).on('pagecontainerbeforehide', loadCollectionDestroy{{randomNumber}});
   jQuery(document).on('pagecontainershow', loadCollectionTrigger{{randomNumber}});
   jQuery(document).on('pageremove', currentPage, removeEvents{{randomNumber}});
   },900);
   }
  

  
  
});  
   
  
  
function loadCollectionDestroy{{randomNumber}} (event, ui) {
  var collection = document.querySelector('.collection-{{ randomNumber }}');                                
  if(collection) {   
  var page = collection.closest('[data-role="page"]');
     if(ui.prevPage[0].id == page.id) {
      var page = ui.prevPage[0];
      page.infScroll.destroy();
      //  console.log('destroyed' + page.id); 

  } 
  }
}  
  
function loadCollectionTrigger{{randomNumber}} (event, ui) {
   var collection = document.querySelector('.collection-{{ randomNumber }}');
   if(collection) { 
   var page = document.querySelector('.collection-{{ randomNumber }}').closest('[data-role="page"]');
    if(ui.toPage[0].id == page.id) {
       loadCollection();
    }
   }
}  
  
function removeEvents{{randomNumber}}(event)  {

   var collection = document.querySelector('.collection-{{ randomNumber }}');
   if(collection) { 
   var page = document.querySelector('.collection-{{ randomNumber }}').closest('[data-role="page"]');  
  if(event.target.id ==  page.id) {
   // console.log('remove events ' + page.id); 
   jQuery(document).off('pagecontainerhide', loadCollectionDestroy{{randomNumber}});
   jQuery(document).off('pagecontainershow', loadCollectionTrigger{{randomNumber}});
   }
  }
}
  
  
function loadCollection() {

  var page = document.querySelector('.collection-{{ randomNumber }}').closest('[data-role="page"]');
                               
  var container = page.querySelector('.collection-container');
  page.infScroll = new InfiniteScroll( container, {
  path: '#' + page.id + ' .next a',
  append: '.product',
  history: false,
  status: '.ui-loader',
  });

   page.infScroll.on( 'last', function() {
       $.mobile.loading().hide();
   });
    //console.log('loaded' + page.id);
  
}  
  
  
</script>
{% endpaginate %}

{% comment %}
  JavaScript for collection sorting.
{% endcomment %}
<script>
jQuery('.sort-by')
  .val('{{ collection.sort_by | default: collection.default_sort_by }}')
  .on('change', function() {
    Shopify.queryParams.sort_by = jQuery(this).val();
    location.search = jQuery.param(Shopify.queryParams).replace(/\+/g, '%20');
  });
</script>

{% schema %}
  {
    "name": "Collection",
    "settings": [
{
   "type": "select",
   "id": "products_per",
   "options": [
      { "value": "2", "label": "2 Products per row"},
      { "value": "3", "label": "3 Products per row"},
      { "value": "4", "label": "4 Products per row"}
   ],
   "default": "4",
   "label": "Show how many per row"
},
{
"type": "checkbox",
"id": "sezzle",
"label": "Show Sezzle Price",
"default": false
},{
 "type": "header",
 "content": "Buy Now Button"
},
{
       "id": "buynowtext",
       "type": "text",
       "label": "Button Text",
       "default": "Buy Now"
},
{
       "id": "buynowbackground",
       "type": "color",
       "label": "Background Color",
       "default": "#000000"
},
{
       "id": "buynowcolor",
       "type": "color",
       "label": "Font Color",
       "default": "#FFFFFF"
}]
  }
{% endschema %}

{% stylesheet 'scss' %}
@mixin bp($point) {
  
  $bp-small: "(max-width: 350px)";
  $bp-mobile: "(max-width: 600px)";
  $bp-mobileup: "(min-width: 600px)";
  $bp-phablet: "(max-width: 1022px)";
  $bp-phabletup: "(min-width: 1022px)";
  $bp-tablet: "(max-width: 1280px)";
  $bp-tabletup: "(min-width: 1280px)";
  $bp-laptop: "(max-width: 1600px)";
  $bp-desktop: "(min-width: 1600px)";
  @if $point == desktop {
    @media #{$bp-desktop}  { @content; }
  }  
  @else if $point == laptop {
    @media #{$bp-laptop} { @content; }
  }
  @else if $point == tablet {
    @media #{$bp-tablet} { @content; }
  }
  @else if $point == tabletup {
    @media #{$bp-tabletup} { @content; }
  }
  @else if $point == phablet {
    @media #{$bp-phablet} { @content; }
  }
  @else if $point == phabletup {
    @media #{$bp-phabletup} { @content; }
  }
  @else if $point == mobile {
    @media #{$bp-mobile}  { @content; }
  }
  @else if $point == mobileup {
    @media #{$bp-mobileup} { @content; }
  }
  @else if $point == small {
    @media #{$bp-small}  { @content; }
  }

}

//color transition
@mixin transition($attribute, $duration) {
    -webkit-transition: $attribute $duration ease;
    -moz-transition: $attribute $duration ease;
    transition: $attribute $duration ease;
}

.collection-page {

  & .sezzle-wrap {
         text-align: center;
                margin-top: 10px;
                   font-weight: 300;
                font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",Arial,sans-serif;
            @include bp(mobile) {
                font-size: 11px !important;
    line-height: 22px !important;
            }
            & > span {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    line-height: 1;
              & > span:nth-child(1) {
    color: #4bb63f !important;
    font-weight: 900;
    font-family: 'OswaldMedium', sans-serif !important;
    font-style: italic !important;
    font-size: 145% !important;
    margin-right: 5px;
               & sup {
                  margin-left: 4px;
               }
              }
              & svg {
    width: 55px;
    height: 100%;
    max-height: 100%;
       margin: 0 5px;             
              }
              & span.sezzle-info-icon {
    vertical-align: text-top;
            
              cursor:pointer;
                @include bp(mobile) {
                    margin-bottom: 2px;
                }
              }
            }
   }
   & .pagination {
text-align: center;
    display: none;
    justify-content: center;
& .current {
background: #efefef;
    color: #000000;
}
}
}

{% endstylesheet %} 

{% javascript %}
{% endjavascript %}  
